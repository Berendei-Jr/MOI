#include <iostream>
#include <math.h>
using namespace std;

int main()
{
	setlocale(LC_ALL, "rus");

	unsigned long long p;
label:
	p = 0;
	cout << "Введите простое число Р: "; cin >> p;
	if (p >= 2) {
		for (int i = 2; i < p; i++) {
			if (p % i == 0) {
				cout << "Введенное число не является простым!\n";
				goto label;
			}
		}
	}
	unsigned int* ARR1 = new unsigned int[p];
	cout << "Расчет первого массива" << endl;
	for (int i = 1; i < p; i++) {
		ARR1[i - 1] = i;
	}

	unsigned int* ARR2 = new unsigned int[p];
	cout << "Расчет квадратов чисел массива по модулю P" << endl;
	for (int i = 1; i < p; i++) {
		ARR2[i - 1] = ((i * i) % p);
	}

	/*int k = 0, s;
	cout << "Расчет количества 'плюсов'..." << endl;
	for (int i = 0; i < ((p + 1) / 2); i++) {
		for (int j = 0; j < ((p + 1) / 2); j++) {
			if (ARR1[i] == ARR2[j]) {
				k++;
				break;
			}
		}
		if (i == ((p + 1) / 8)) {
			cout << "Завершено на 25%...\n";
		}
		if (i == ((p + 1) / 4)) {
			cout << "Завершено на 50%...\n";
		}
		if (i == ((p + 1) / 8 * 3)) {
			cout << "Завершено на 75%...\n";
		}
		if (i == ((p + 1) / 2)) {
			cout << "Завершено на 100%...\n";
		}
	}
	cout << "Количество 'плюсов': " << k * 2 << endl;*/

	int c ;
	c = 0;
	cout << "\n   Введите значение константы С: "; cin >> c;
	const int length = floor(c * (log(p) / log(2) + log((log(p) / log(2)) / log(2))));  //C(Log2(p) +log2(log2(p)))
	cout << "L = " << length << endl;
label1:
	int index;
	cout << "Введите индекс начального положения: "; cin >> index;
	if ((index + length) > p) {
		cout << "Выход за границу справа!\n";
		goto label1;
	}

	int k = 0;
	for (int i = index; i < (index + length); i++) {
		for (int j = 0; j < ((p + 1) / 2); j++) {
			if (ARR1[i] == ARR2[j]) {
				//cout << "Chislo " << ARR1[i] << endl;
				k++;
				break;
			}
		}
		//cout << "            i = " << i << endl;
	}
	if (k >= (length - k)) {
		cout << "Операция завершена. Больше плюсов" << endl;
	}
	else cout << "Операция завершена. Больше минусов" << endl;
label2:
	char Ch;
	cout << "Перемещаемся вправо или влево? [R, L]  "; cin >> Ch;
	if (Ch == 'R' || Ch == 'r') {
		int index_0 = index+length;
				if ((index_0 + length) > p) {
					cout << "Выход за границу справа!\n";
					goto label2;
				}
		k = 0;
		for (int i = index_0; i < (index_0 + length); i++) {
			for (int j = 0; j < ((p + 1) / 2); j++) {
				if (ARR1[i] == ARR2[j]) {
					k++;
					break;
				}
			}
		}
		if (k >= (length - k)) {
			cout << "Операция завершена. Больше плюсов" << endl;
		}
		else cout << "Операция завершена. Больше минусов" << endl;
	}

	else {
		int index_1 = index-length;
		if ((index_1 - length) < 0) {
			cout << "Выход за границу слева!\n";
			goto label2;
		}
		k = 0;
		for (int i = index_1; i < (index_1 + length); i++) {
			for (int j = 0; j < ((p + 1) / 2); j++) {
				if (ARR1[i] == ARR2[j]) {
					k++;
					break;
				}
			}
		}
		if (k >= (length - k)) {
			cout << "Операция завершена. Больше плюсов" << endl;
		}
		else cout << "Операция завершена. Больше минусов" << endl;
	}

	//goto label1;


	return 0;
}
